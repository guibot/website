{{ define "main" }}
<article class="journal-single">
    <header>
        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "02 January 2006" }}</time>
        <h1>{{ .Title }}</h1>
        {{ if .Params.tags }}
        <div class="tags">
            {{ range .Params.tags }}
                {{ $term := $.Site.GetPage (printf "/tags/%s" (urlize .)) }}
                {{ if $term }}
                    <a class="tag" href="{{ $term.RelPermalink }}">{{ . }}</a>
                {{ else }}
                    <span class="tag">{{ . }}</span>
                {{ end }}
            {{ end }}
        </div>
        {{ end }}
    </header>
    
    {{ if and .Params.cover .Params.showCover }}
    {{ $coverURL := "" }}
    {{ $res := .Resources.GetMatch .Params.cover }}
    {{ if not $res }}
        {{ $res = .Resources.GetMatch (path.Base .Params.cover) }}
    {{ end }}
    {{ if $res }}
        {{ $coverURL = $res.RelPermalink }}
    {{ else if or (strings.HasPrefix .Params.cover "http") (strings.HasPrefix .Params.cover "/") }}
        {{ $coverURL = .Params.cover }}
    {{ end }}
    {{ if $coverURL }}
    <figure class="journal-cover">
        <img src="{{ $coverURL }}" alt="{{ .Title }}">
    </figure>
    {{ end }}
    {{ end }}
    
    <div class="journal-content">
        {{ .Content }}
    </div>
    
    <nav class="journal-nav">
        <div class="nav-links">
            {{ with .PrevInSection }}
            <a class="nav-prev" href="{{ .Permalink }}">&larr; {{ .Title }}</a>
            {{ end }}
            {{ with .NextInSection }}
            <a class="nav-next" href="{{ .Permalink }}">{{ .Title }} &rarr;</a>
            {{ end }}
        </div>
        <a class="nav-back" href="/journal/">&larr; Back to Journal</a>
    </nav>
</article>
{{ end }}
